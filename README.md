# 智慧醫師排班系統 (Intelligent Physician Scheduling System) v2.7

本專案旨在解決一個複雜的醫療排班問題。它使用 Google 的 OR-Tools (CP-SAT Solver)，一個強大的約束滿足程式庫，來生成不僅合乎所有硬性規定，且在多個維度上都達到最佳化的醫師班表。

---

## 核心功能

* **遵守嚴格的硬性規則**：絕不產生違反規定的班表，包括：
    * 醫師排班後至少連休兩天。
    * 個人排班點數不超過上限。
    * 國定假日與週末的點數加倍計算。
    * 完美避開所有醫師預先申請的休假日。
    * 嚴格限制特定區域（I區）只能由特定資格的醫師排班。

* **多層次的智慧優化目標**：不僅是「排出來」，更是「排得好」。系統會最大化一個綜合分數，該分數由以下多個目標加權而成：
    * **最大化總工時**：優先讓所有醫師的可用點數被充分利用。
    * **人性化班表分散**：強力獎勵班與班之間有更長的休息間隔。
    * **避免極端班表**：用巨額懲罰來避免剛好只休兩天的「極限班表」。
    * **確保團隊公平性**：在總工時無法排滿時，追求同區域、同等級的醫師們能公平地分攤未排的時數。
    * **區域熟悉度獎勵**：在滿足所有更重要的目標後，稍微傾向於讓醫師在自己熟悉的區域工作。

* **自動化專業報告**：一鍵執行，自動生成一份精美的多頁籤 Excel 報告 (`.xlsx`)，包含：
    * 視覺化的醫師個人月曆班表。
    * 詳盡的點數使用統計總覽。
    * 以科室為單位的區域總班表。

* **透明化的決策過程**：執行過程中，系統會即時印出它找到的每一個可行解及其詳細評分，讓管理者能清楚看見最佳解是如何被挑選出來的。

---

## 決策邏輯：系統如何「思考」？

本系統的智慧之處在於其加權評分機制。它會依據以下優先級（由高至低）來評斷一個班表的好壞：

1.  **【絕對前提】滿足所有硬性規定**：這是 0 與 1 的區別，不滿足則解不存在。
2.  **【最高優先懲罰】避免隔兩天班** (權重: -500)：最不希望發生的事，用巨大負分強力排除。
3.  **【主要目標】最大化總使用點數** (權重: 10000)：最重要的正向目標，讓醫院運作最飽滿。
4.  **【次要目標】追求同儕公平** (權重: -200)：在無法滿足主要目標時的重要補救措施。
5.  **【一般偏好】填滿班表 & 分散班表** (權重: 100 & 10)：常規性的優化，讓班表更完善。
6.  **【打破平局】區域獎勵** (權重: 10 & 0.1)：在多個解都同樣優秀時，用來選擇更優解的最後依據。

---

## 如何使用

### 1. 環境設定

本專案需要以下 Python 函式庫。建議使用 Python 3.8 或以上版本。

```bash
pip install pandas ortools holidays openpyxl
```

### 2. 客製化設定

您可以直接在 `scheduler_v2.7.py` 檔案中修改以下部分來自訂您的排班需求：

* **修改醫師資料**：在 `solve_schedule` 函式中找到 `csv_data` 變數，直接修改其中的醫師姓名、區域、點數上限與不可排班日。

    ```python
    csv_data = """
    醫師姓名,區域,點數上限,不可排班日
    如,A,8,"26,27"
    秀,A,8,"1,2,5,6"
    ...
    """
    ```

* **修改排班月份**：修改 `YEAR` 和 `MONTH` 變數。

    ```python
    YEAR, MONTH = 2025, 9
    ```

* **調整優化目標的權重**：您可以根據您的管理哲學，微調 `weights` 字典中的數值，來改變系統的決策偏好。

    ```python
    weights = {
        'total_used_points': 10000,
        'min_gap_count': -500,
        'fairness_penalty': -200,
        'total_shifts_filled': 100,
        'linear_gaps_bonus': 10,
        'i_priority_bonus': 10,
        'home_area_bonus': 0.1,
    }
    ```

### 3. 執行排班

開啟終端機 (Terminal) 或命令提示字元 (Command Prompt)，移動到專案所在的資料夾，然後執行：

```bash
python scheduler_v2.7.py
```

### 4. 查看結果

程式執行完畢後，您會在同一個資料夾下找到一份名為 `schedule_result_v2.7_YYYY-MM.xlsx` 的 Excel 檔案，裡面就是為您量身打造的最佳班表！

---

## 授權條款 (License)

本專案採用 [MIT License](https://opensource.org/licenses/MIT) 授權。

---
## 致謝

* 感謝 Google 提供強大的 [OR-Tools](https://github.com/google/or-tools) 開源工具。
